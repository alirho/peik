<!DOCTYPE html>
<html class="dark" dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>ูพฺฉ - ุฏุณุชุงุฑ ููุด ูุตููุน</title>
    
    <link rel="icon" type="image/svg+xml" href="assets/images/logo.svg" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

    <!-- WebUI Styles -->
    <link rel="stylesheet" href="plugins/presentation/webUI/styles/main.css">
</head>
<body>
    <div id="root"></div>
    
    <!-- Main Application Script -->
    <script type="module">
        import { Peik } from './core/src/index.js';
        import MemoryStorage from './plugins/platform/memoryStorage/index.js';
        import FetchHttp from './plugins/platform/fetchHttp/index.js';
        import GeminiProvider from './plugins/core/geminiProvider/index.js';
        import OpenAIProvider from './plugins/core/openaiProvider/index.js';
        import WebUIPlugin from './plugins/presentation/webUI/index.js';

        (async () => {
            try {
                console.log('๐ ุฏุฑ ุญุงู ุฑุงูโุงูุฏุงุฒ ูพฺฉ...');
                const peik = new Peik();

                // ฑ. ุซุจุช ุงูุฒูููโูุง ุฒุฑุณุงุฎุช
                // ูฺฉุชู: ุจุฑุง ุฐุฎุฑูโุณุงุฒ ุฏุงุฆู ุจุงุฏ ุงุฒ IndexedDBPlugin ุงุณุชูุงุฏู ุดูุฏ (ูุนูุง MemoryStorage ุจุฑุง ุชุณุช)
                await peik.use(new MemoryStorage());
                await peik.use(new FetchHttp());

                // ฒ. ุซุจุช ุงุฑุงุฆูโุฏููุฏฺฏุงู ููุด ูุตููุน
                await peik.use(new GeminiProvider());
                await peik.use(new OpenAIProvider());

                // ณ. ุซุจุช ุฑุงุจุท ฺฉุงุฑุจุฑ (ูุชุตู ุจู div#root)
                await peik.use(new WebUIPlugin('root'));

                // ด. ุฑุงูโุงูุฏุงุฒ ููุง
                await peik.init();
                console.log('โ ูพฺฉ ุจุง ููููุช ุขูุงุฏู ุดุฏ.');

            } catch (error) {
                console.error("โ ุฎุทุง ูููฺฉ ุฏุฑ ุฑุงูโุงูุฏุงุฒ:", error);
                const root = document.getElementById('root');
                if (root) {
                    root.innerHTML = `
                        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;color:#ef4444;font-family:'Vazirmatn',sans-serif;text-align:center;padding:20px;">
                            <span class="material-symbols-outlined" style="font-size:48px;margin-bottom:16px;">error</span>
                            <h2>ุฎุทุง ุฏุฑ ุฑุงูโุงูุฏุงุฒ ุจุฑูุงูู</h2>
                            <p style="direction:ltr;background:#eee;padding:10px;border-radius:5px;margin-top:10px;color:#333;">${error.message}</p>
                        </div>
                    `;
                }
            }
        })();
    </script>
</body>
</html>